{% extends "base.html" %}

{% block head %}
{{super()}}
{% if has_preview %}
<!-- TODO: parameterize the version number -->
<link
href="https://cdn.pydata.org/bokeh/release/bokeh-0.12.13.min.css"
rel="stylesheet" type="text/css">
<link
href="https://cdn.pydata.org/bokeh/release/bokeh-widgets-0.12.13.min.css"
rel="stylesheet" type="text/css">

<script src="https://cdn.pydata.org/bokeh/release/bokeh-0.12.13.min.js"></script>
<script src="https://cdn.pydata.org/bokeh/release/bokeh-api-0.12.13.min.js"></script>
<script src="https://cdn.pydata.org/bokeh/release/bokeh-widgets-0.12.13.min.js"></script>
<script src="https://cdn.pydata.org/bokeh/release/bokeh-tables-0.12.13.min.js"></script>
{% endif %}
{% endblock %}

{% block content %}

<div class="container container-main" role="main">
    <h4>Results for query id {{ user_id }}</h4>
    {% if has_preview %}
    Data preview is available
    <h5>Visualization</h5>

    <div>Number of cells: {{ cells }}</div>
    <div>Number of genes: {{ genes }}</div>

    {{ visualization }}
    <!-- TODO: submit revisions? -->


    {% if not uncurl_is_running %}
    <form action="start" method="post" enctype="multipart/form-data">

        <div class="form-group">

            
            <label for="min-reads">Remove cells with read counts less than:</label>
            <input type="number" id="min-reads" name="min_reads" value={{ min_reads }}>
            <br>

            <label for="max-reads">Remove cells with read counts greater than:</label>
            <input type="number" id="max-reads" name="max_reads" value={{ max_reads }}>
            <br>
        </div>

        <div class="form-group">
            <label for="k">Number of states (k):</label>
            <input type=number id="k" name="k" value=2>
        </div>

        <div class="form-group">
            <label for="disttype">Distribution type:</label>
            <select id="disttype" name="disttype">
                <option selected>Poisson</option>
                <option>Log-Normal</option>
                <option>Negative binomial</option>
            </select>
        </div>

        <div class="form-group">
            <label for="genes-frac">Fraction of genes to include (put 1.0 to include all genes):</label>
            <input type="number" id="genes-frac" name="genes_frac" value=0.2 step="0.01" min="0.0" max="1.0">
        </div>

        <div class="form-group">
            <label for="cell-frac">Fraction of cells to include for visualization:</label>
            <input type="number" id="cell-frac" name="cell_frac" value=1.0 step="0.01" min="0.0" max="1.0">
        </div>

        <div class="form-group">
            <label for="cell-norm">Normalize cells by read count:</label>
            <input type="checkbox" id="cell-norm" name="normalize" value="1">
        </div>

        <div class="form-group">
            <label for="vismethod">Visualization method:</label>
            <select id="vismethod" name="vismethod">
                <option selected>MDS</option>
                <option>tSNE</option>
                <option>PCA</option>
            </select>
        </div>


        <div class="form-group">
            <button type="submit" class="btn btn-default">Submit</button>
        </div>

    </form>

    {% else %}
    Currently running uncurl. Will refresh every 60 seconds.

    <script>
        setTimeout(function(){
           window.location.reload(1);
        }, 60000);
    </script>
    {% endif %}

    {% elif uncurl_is_running %}
    <p>Results</p>
    Results not yet available. Will refresh every 60 seconds.

    <script>
        setTimeout(function(){
           window.location.reload(1);
        }, 60000);
    </script>
    {% else %}
    <p>Data preview</p>
    Data preview not yet available. Will refresh every 20 seconds.

    <script>
        setTimeout(function(){
           window.location.reload(1);
        }, 20000);
    </script>
    {% endif %}

</div>

{% endblock %}
